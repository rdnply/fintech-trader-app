{{define "head"}}<title>Роботы</title>{{end}}
{{define "body"}}
<script type="text/javascript">
    window.onload = function () {
        if (window["WebSocket"]) {
            conn = new WebSocket("ws://localhost:5000/ws");

            conn.onopen = function () {
                console.log("WS is opened");
            };

            conn.onclose = function (evt) {
                console.log("WS is closed");
            };


            conn.onmessage = function (evt) {
                var msg = JSON.parse(evt.data);
                var id = msg.robot_id;
                console.log(id);
                console.log(msg);

                for (var key in msg) {
                    if (msg.hasOwnProperty(key)) {
                        console.log(key + " -> " + msg[key]);
                        var cell = document.getElementById(key + "_" + id);
                        console.log(cell)
                        if(cell) {
                            cell.innerHTML = msg[key];
                        }
                    }
                }
            };
        } else {
            console.log("Cannot open websocket");
        }
    };
</script>

<div>
    <table border="1">
        <tr>
            <th>Идентификатор робота</th>
            <th>Владелец робота</th>
            <th>Идентификатор родителя</th>
            <th>Избранное</th>
            <th>Активность</th>
            <th>Тикер</th>
            <th>Цена покупки</th>
            <th>Цена продажи</th>
            <th>Плановая дата запуска</th>
            <th>Плановая дата остановки</th>
            <th>Плановая доходность</th>
            <th>Фактическая доходность</th>
            <th>Кол-во сделок</th>
            <th>Дата активации</th>
            <th>Дата деактивации</th>
            <th>Дата регистрации</th>
            <th>Дата удаления</th>
        </tr>
        {{/*            <td><div id="price_{{$value.ID}}">{{$value.StartPrice}}</div></td>*/}}

        {{range $ind, $el := . }}
        <tr>
            <div id="{{printf "robot_%d" .RobotID}}">
                <td id="{{printf "robot_id_%d" .RobotID}}">{{$el.RobotID}}</td>
                <td id="{{printf "owner_user_id_%d" .RobotID}}">{{$el.OwnerUserID  }}</td>
                <td id="{{printf "parent_robot_id_%d" .RobotID}}">{{$el.ParentRobotID | printInt}}</td>
                <td id="{{printf "is_favourite_%d" .RobotID}}">{{$el.IsFavourite  }}</td>
                <td id="{{printf "is_active_%d" .RobotID}}">{{$el.IsActive     }}</td>
                <td id="{{printf "ticker_%d" .RobotID}}">{{$el.Ticker | printStr }}</td>
                <td id="{{printf "buy_price_%d" .RobotID}}">{{$el.BuyPrice   | printFloat }}</td>
                <td id="{{printf "sell_price_%d" .RobotID}}">{{$el.SellPrice  | printFloat  }}</td>
                <td id="{{printf "plan_start_%d" .RobotID}}">{{$el.PlanStart  | printTime  }}</td>
                <td id="{{printf "plan_end_%d" .RobotID}}">{{$el.PlanEnd    | printTime  }}</td>
                <td id="{{printf "plan_yield_%d" .RobotID}}">{{$el.PlanYield  | printFloat  }}</td>
                <td id="{{printf "fact_yield_%d" .RobotID}}">{{$el.FactYield  | printFloat  }}</td>
                <td id="{{printf "deals_count_%d" .RobotID}}">{{$el.DealsCount | printInt  }}</td>
                <td id="{{printf "activated_at_%d" .RobotID}}">{{$el.ActivatedAt | printTime  }}</td>
                <td id="{{printf "deactivated_at_%d" .RobotID}}">{{$el.DeactivatedAt | printTime}}</td>
                <td id="{{printf "created_at_%d" .RobotID}}">{{$el.CreatedAt  | printTime  }}</td>
                <td id="{{printf "deleted_at_%d" .RobotID}}">{{$el.DeletedAt  | printTime  }}</td>
            </div>
        </tr>
        {{end}}
    </table>
</div>
{{end}}
